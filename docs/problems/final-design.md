# KMS 프로젝트 최종 설계: 현실적 구현 방안

## 문서 정보
- 작성일: 2026-02-08
- 목적: 실제 구현할 최종 설계안
- 성격: 현실적 제약을 반영한 실행 계획

---

# 1. Executive Summary

> **"정론을 알고, 현실에 맞게 설계했다"**

이 문서는 예산, 인력, 기술 역량의 현실적 제약을 고려하여 도출한 최종 설계안입니다. 데이터 엔지니어링 영역을 과감히 제외하고, 문서 체계 관리에 집중합니다.

## 핵심 결정

| 항목 | 결정 |
|------|------|
| 구현 범위 | 문서 체계 관리 + 뷰어 + API |
| 제외 범위 | PDF 파싱, NLP, 벡터 DB, RAG |
| 기술 스택 | .NET Core + Vue 3 + PostgreSQL |
| 개발 인력 | 1명 (백엔드 + 프론트 직접 구현) |
| 개발 기간 | 2-3개월 |
| 예산 | 인건비만 (외주 시 2-3천만원) |

---

# 2. 고민 과정

## 2.1 검토한 선택지들

| 선택지 | 결과 | 사유 |
|--------|------|------|
| 올인원 시스템 (Neo4j + Python) | 기각 | 기술 역량 부재, 실패 확률 96% |
| 전문 인력 채용 후 진행 | 기각 | 예산 부족, 채용 불확실성 |
| 전부 외주 | 기각 | 비용 과다, 기술 종속 |
| **체계 관리 + 외주 연동** | **채택** | 현실적, 성공 확률 70% |

## 2.2 핵심 통찰

```
깨달음 1: 데이터 엔지니어링은 우리 역량 밖
→ PDF 파싱, 한글 NLP, 벡터 DB는 Python 필수
→ Python 운영 역량 없음
→ 이 영역은 포기하거나 외주

깨달음 2: 진짜 자산은 "체계"
→ 문서가 어디에 있고, 무엇이고, 어떻게 연결되는지
→ 이게 데이터 주권의 핵심
→ 처리 기술은 언제든 교체 가능

깨달음 3: 직접 구축 가능한 범위
→ 데이터 엔지니어링 빼면 일반 웹 개발
→ .NET + Vue = 직접 구현 가능
→ 외주/채용 불필요
```

---

# 3. 최종 아키텍처

## 3.1 시스템 구조

```
┌─────────────────────────────────────────────────────────┐
│                  Vue 3 Admin Dashboard                   │
│                                                         │
│  [문서 관리]        [문서 뷰어]        [관계 그래프]     │
│  • 업로드           • PDF 미리보기     • vis-network     │
│  • 분류 선택        • 메타데이터       • 관계 탐색       │
│  • 상태 변경        • 다운로드         • 깊이 조절       │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│                  .NET Core 8 API                         │
│                                                         │
│  [문서 CRUD]        [분류/관계]        [외부 API]        │
│  • 업로드/저장      • 분류 관리        • /api/v1/docs   │
│  • 메타데이터       • 관계 CRUD        • /api/v1/files  │
│  • 라이프사이클     • 순환 참조 방지   • 인증 (API Key) │
└──────────────────────┬──────────────────────────────────┘
                       │
┌──────────────────────▼──────────────────────────────────┐
│                    PostgreSQL 16                         │
│                                                         │
│  [documents]        [classifications]   [relations]      │
│  • 메타데이터       • EAV 패턴         • 관계 저장       │
│  • 라이프사이클     • facet 확장 가능  • 순환 체크       │
└──────────────────────┬──────────────────────────────────┘
                       │
                 [REST API 제공]
                       │
         ┌─────────────┴─────────────┐
         ▼                           ▼
    ┌─────────┐                 ┌─────────┐
    │ 외주 A   │                 │ 외주 B   │
    │ RAG업체  │                 │ 미래업체 │
    └─────────┘                 └─────────┘
```

## 3.2 기술 스택

| 레이어 | 기술 | 버전 | 선정 이유 |
|--------|------|------|----------|
| Frontend | Vue 3 | 3.4+ | 회사 표준, 직접 구현 가능 |
| UI | Element Plus | 2.x | Vue 3 호환, 한글화 |
| 빌드 | Vite | 5.x | Vue 공식, 빠름 |
| Backend | ASP.NET Core | 8.0 LTS | 직접 구현 가능, IT팀 운영 |
| ORM | EF Core | 8.x | MS 공식 |
| Database | PostgreSQL | 16 | 무료, JSONB, 확장성 |
| PDF 뷰어 | pdf.js | - | 모질라 오픈소스 |
| Markdown 뷰어 | marked.js | - | 경량, 표준 |
| CSV 뷰어 | 자체 구현 | - | Vue 테이블 컴포넌트 |
| 그래프 | vis-network | 9.x | Phase 1 검증됨 |

---

# 4. 기능 범위

## 4.1 허용 파일 형식

| 형식 | 허용 | 뷰어 | 사유 |
|------|------|------|------|
| **PDF** | O | pdf.js | 표준 문서 형식 |
| **Markdown** | O | marked.js | 텍스트 기반, 버전관리 용이 |
| **CSV** | O | 테이블 렌더링 | 데이터 표준 형식 |
| Word (.doc, .docx) | **X** | - | 형식 복잡, 뷰어 불안정 |
| PowerPoint (.ppt, .pptx) | **X** | - | 형식 복잡, 뷰어 불안정 |
| Excel (.xls, .xlsx) | **X** | - | CSV로 변환 권장 |

```
업로드 시 파일 검증:
1. 확장자 체크 (.pdf, .md, .csv만 허용)
2. MIME 타입 체크
3. 그 외 형식 → 업로드 거부 + 안내 메시지
```

---

## 4.2 포함 (직접 구현)

| 기능 | 상세 | 난이도 |
|------|------|--------|
| 파일 업로드 | PDF/MD/CSV 업로드, 형식 검증 | 하 |
| 분류 선택 | 보험사/상품/문서유형 드롭다운 | 하 |
| 분류 제안 | 파일명 정규식 파싱 (선택) | 중 |
| 관계 CRUD | 부모-자식, 참조, 대체 관계 | 중 |
| 순환 참조 방지 | DB 트리거 또는 앱 로직 | 중 |
| 라이프사이클 | DRAFT → ACTIVE → DEPRECATED | 하 |
| SSOT 보장 | 중복 문서 경고 | 중 |
| 신선도 계산 | HOT/WARM/COLD 자동 | 하 |
| PDF 뷰어 | pdf.js 인라인 뷰어 | 하 |
| Markdown 뷰어 | marked.js 렌더링 | 하 |
| CSV 뷰어 | 테이블 컴포넌트 | 하 |
| 파일 형식 검증 | PDF/MD/CSV만 허용 | 하 |
| 관계 그래프 | vis-network 시각화 | 중 |
| 외부 API | REST API + API Key 인증 | 중 |
| 메타데이터 검색 | 분류, 상태 필터 | 하 |

## 4.2 제외 (외주 위임)

| 기능 | 사유 | 외주 담당 |
|------|------|----------|
| PDF 텍스트 추출 | Python 필요 | RAG 업체 |
| 한글 NLP | Python 필요 | RAG 업체 |
| 자동 분류 (ML) | ML 역량 필요 | RAG 업체 |
| 본문 검색 | 벡터 DB 필요 | RAG 업체 |
| 벡터 DB 구축 | Python 필요 | RAG 업체 |
| RAG 챗봇 | LLM 연동 필요 | RAG 업체 |

---

# 5. 데이터베이스 설계

> **정본**: `phase2/database-schema.md` 참조

## 5.1 테이블 구조

| 테이블 | 설명 |
|--------|------|
| `users` | 사용자 인증 |
| `domain_master` | 도메인 정의 |
| `facet_master` | 분류 마스터 (신선도 포함) |
| `documents` | 문서 메타데이터 |
| `classifications` | 문서별 분류 |
| `relations` | 문서 관계 |
| `document_history` | 변경 이력 |
| `api_keys` | 외부 API 키 |

## 5.2 주요 결정

| 항목 | 결정 |
|------|------|
| 라이프사이클 | DRAFT → ACTIVE → DEPRECATED (3단계) |
| SSOT | 트리거로 같은 분류+ACTIVE 1개 보장 |
| 순환 참조 | 트리거로 INSERT/UPDATE 시 체크 |
| 동시성 | `row_version` 컬럼으로 낙관적 잠금 |
| 신선도 | `facet_master.max_age_days` + `documents.reviewed_at` |

## 5.3 확장 포인트 (Phase 3)

```sql
-- 나중에 추가 (지금 안 만듦)
-- document_content (full_text, keywords)
-- document_embeddings (vector)
```

---

# 6. API 설계

## 6.1 내부 API (Admin용)

```
POST   /api/documents              문서 업로드
GET    /api/documents              문서 목록
GET    /api/documents/{id}         문서 상세
PUT    /api/documents/{id}         문서 수정
DELETE /api/documents/{id}         문서 삭제 (논리)

GET    /api/documents/{id}/file    파일 다운로드
GET    /api/documents/{id}/relations  관계 목록

POST   /api/relations              관계 생성
DELETE /api/relations/{id}         관계 삭제

GET    /api/taxonomy/carriers      보험사 목록
GET    /api/taxonomy/products      상품 목록
GET    /api/taxonomy/doctypes      문서유형 목록
```

## 6.2 외부 API (외주용)

```
GET /api/v1/documents              문서 목록 (필터, 페이징)
GET /api/v1/documents/{id}         문서 메타데이터
GET /api/v1/documents/{id}/file    원본 파일 다운로드
GET /api/v1/documents/{id}/relations  관계 조회

인증: X-API-Key 헤더
```

---

# 7. 파일 저장 구조

```
storage/
├── originals/                 # 원본 파일
│   └── {domain}/
│       └── {year}/
│           └── {id}.pdf
│
├── thumbnails/                # 미리보기 (선택)
│   └── {id}.png
│
└── extracted/                 # Phase 3용 (비워둠)
    └── {id}.txt
```

---

# 8. 개발 일정

| 주차 | 마일스톤 | 상세 |
|------|---------|------|
| W1-2 | 환경 구축 | 프로젝트 셋업, DB 스키마, 기본 API |
| W3-4 | 문서 CRUD | 업로드, 분류, 메타데이터 관리 |
| W5-6 | 관계 관리 | 관계 CRUD, 순환 방지, 그래프 시각화 |
| W7-8 | Admin UI | Vue 3 대시보드, PDF 뷰어 |
| W9-10 | 외부 API | v1 API, 인증, 문서화 |
| W11-12 | 안정화 | 테스트, 버그 수정, 운영 준비 |

**총 기간: 3개월**

---

# 9. 비용

## 9.1 직접 개발 시

| 항목 | 비용 |
|------|------|
| 개발 인건비 | 내부 인력 (추가 비용 0) |
| 인프라 | 기존 서버 활용 (0) |
| **합계** | **0원** (인건비 별도) |

## 9.2 외주 개발 시

| 항목 | 비용 |
|------|------|
| 백엔드 개발 | 1,500만원 |
| 프론트엔드 개발 | 1,000만원 |
| 인프라 구축 | 500만원 |
| **합계** | **3,000만원** |

## 9.3 연간 운영

| 항목 | 비용 |
|------|------|
| 서버 운영 | 500만원 |
| 유지보수 | 500만원 |
| **합계** | **1,000만원/년** |

---

# 10. 성공 확률

| 단계 | 확률 | 근거 |
|------|------|------|
| 개발 완료 | 90% | 일반 웹 개발 범위 |
| 운영 이관 | 85% | IT팀 .NET 역량 보유 |
| 사용자 수용 | 70% | MVP로 검증 후 확대 |
| 5년 후 운영 | **70%** | 단순 구조, 유지보수 용이 |

---

# 11. 확장 로드맵

## Phase 2 (현재) → Phase 3 (미래)

```
Phase 2 완료 후, 다음 조건 충족 시 확장:
• 예산 추가 확보 (5,000만원+)
• 전문 인력 채용 또는 외주 계약
• Phase 2 안정적 운영 확인

Phase 3 확장 내용:
• Python Core Engine 추가
• 문서 텍스트 추출
• 자동 분류 고도화
• 벡터 DB 연동
• RAG 내재화
```

## 확장 인터페이스

```csharp
// Phase 2에서 정의만
public interface IDocumentProcessor
{
    Task<ExtractedContent> ExtractText(string filePath);
    Task<ClassificationSuggestion> SuggestClassification(string text);
}

// Phase 3에서 구현
public class PythonDocumentProcessor : IDocumentProcessor
{
    // Python 서비스 호출
}
```

---

# 12. 결론

## 최종 설계 요약

| 항목 | 내용 |
|------|------|
| 범위 | 문서 체계 관리 + 뷰어 + API |
| 스택 | .NET Core + Vue 3 + PostgreSQL |
| 인력 | 1명 (직접 구현) |
| 기간 | 3개월 |
| 비용 | 0원 (직접) 또는 3천만원 (외주) |
| 성공 확률 | 70% |

## 정론과의 차이

| 항목 | 정론 | 최종 설계 |
|------|------|----------|
| 비용 | 14억원 | 0~3천만원 |
| 기간 | 12개월 | 3개월 |
| 인력 | 3.5명 | 1명 |
| 범위 | 전체 (RAG 포함) | 체계 관리만 |
| 성공 확률 | 60% | 70% |

## 핵심 메시지

> **"할 수 있는 것에 집중하고, 할 수 없는 것은 맡긴다"**
>
> 데이터 주권은 확보하면서
> 복잡한 처리는 외주에 위임
> 나중에 확장할 수 있도록 설계

---

**문서 끝**
